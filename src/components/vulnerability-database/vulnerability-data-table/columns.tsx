'use client'

import { ColumnDef } from '@tanstack/react-table'
import { ArrowUpDown } from 'lucide-react'
import { Button } from '@/components/ui/button'

export type Vulnerability = {
    cve: string
    cvss: number
    datePublished: Date
    risk: number
    description: string
}

export const columns: ColumnDef<Vulnerability>[] = [
    {
        accessorKey: 'cve',
        header: 'ID',
        size: 150,
        cell: ({ row }) => <div className="w-32">{row.getValue('cve')}</div>,
    },
    {
        accessorKey: 'description',
        header: 'Description',
        size: 400,
        cell: ({ row }) => {
            const description = row.getValue('description') as string
            const truncated =
                description?.length > 100
                    ? description.substring(0, 100) + '...'
                    : description
            return <div className="w-96">{truncated}</div>
        },
    },
    {
        accessorKey: 'cvss',
        size: 100,
        header: ({ column }) => {
            return (
                <div
                    className="flex cursor-pointer items-center hover:text-accent-foreground"
                    onClick={() =>
                        column.toggleSorting(column.getIsSorted() === 'asc')
                    }
                >
                    CVSS
                    <ArrowUpDown className="ml-2 h-4 w-4" />
                </div>
            )
        },
        cell: ({ row }) => <div className="w-20">{row.getValue('cvss')}</div>,
    },
    {
        accessorKey: 'risk',
        size: 100,
        header: ({ column }) => {
            return (
                <div
                    className="flex cursor-pointer items-center hover:text-accent-foreground"
                    onClick={() =>
                        column.toggleSorting(column.getIsSorted() === 'asc')
                    }
                >
                    RISK
                    <ArrowUpDown className="ml-2 h-4 w-4" />
                </div>
            )
        },
        cell: ({ row }) => {
            const risk = row.getValue('risk') as any
            return (
                <div className="w-20">
                    {risk?.baseScore.toFixed(2) || 'N/A'}
                </div>
            )
        },
    },
    {
        accessorKey: 'datePublished',
        size: 150,
        header: ({ column }) => {
            return (
                <div
                    className="flex cursor-pointer items-center hover:text-accent-foreground"
                    onClick={() =>
                        column.toggleSorting(column.getIsSorted() === 'asc')
                    }
                >
                    Published
                    <ArrowUpDown className="ml-2 h-4 w-4" />
                </div>
            )
        },
        cell: ({ row }) => (
            <div className="w-32">{row.getValue('datePublished')}</div>
        ),
    },
]
